<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Dockerless :: Containers Tutorial</title>
    <link rel="canonical" href="https://redhat-scholars.github.io/containers-tutorial/containers-tutorial/dockerless.html">
    <link rel="prev" href="pushing.html">
    <link rel="next" href="skopeo.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="https://redhat-scholars.github.io/containers-tutorial">Containers Tutorial</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="containers-tutorial" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Containers Tutorial</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Requirements</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setup.html">Setup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Basics</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="dockerfile.html">Dockerfile</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="imagemanagement.html">Image management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="runningcontainers.html">Running containers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ports.html">Ports</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="env.html">Environment variables</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="inside.html">Inside a container</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="pushing.html">Pushing an image to a public registry</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="dockerless.html">Dockerless</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Intermediate</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="skopeo.html">Skopeo</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Resources</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="resources.html">Containers</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Containers Tutorial</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Containers Tutorial</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Containers Tutorial</a></li>
    <li>Basics</li>
    <li><a href="dockerless.html">Dockerless</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/redhat-scholars/containers-tutorial/edit/master/documentation/modules/ROOT/pages/dockerless.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Dockerless</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>You can easily build containers within a running container using Dockerless technology.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Complete the <a href="pushing.html" class="xref page">Pushing an image to a public registry</a> section before as you&#8217;ll need to be registered to any public Docker registry like Docker Hub or Quay.io.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jib"><a class="anchor" href="#_jib"></a>Jib</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://github.com/GoogleContainerTools/jib">Jib</a> builds optimized Docker and OCI images for your Java applications without a Docker daemon - and without deep mastery of Docker best practices.</p>
</div>
<div class="paragraph">
<p>We&#8217;ve provided a simple Spring Boot application to containerize using Jib.</p>
</div>
<div class="paragraph">
<p>Go to application directory:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd apps/greeting</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then run the following Maven command to build and push the container without using any Docker host:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw compile com.google.cloud.tools:jib-maven-plugin:3.0.0:build -Dimage=docker.io/lordofthejars/greetings:1.0.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Change <code>docker.io</code> for your container repository location (ie <code>quay.io</code>) and <code>lordofthejars</code> for your user id.</p>
</div>
<div class="paragraph">
<p>And the output should be similar:</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">[INFO] Using credentials from Docker config (/Users/asotobu/.docker/config.json) for adoptopenjdk:11-jre
[INFO] Using base image with digest: sha256:160242e83558e9ada7038601e1e7b4399903700a0b1685f5dced50e6ca05eced
[INFO]
[INFO] Container entrypoint set to [java, -cp, /app/resources:/app/classes:/app/libs/*, org.acme.greeting.GreetingApplication]
[INFO]
[INFO] Built and pushed image as lordofthejars/greetings:1.0.0
[INFO] Executing tasks:
[INFO] [============================  ] 91.7% complete
[INFO] &gt; launching layer pushers
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
No credentials are required as they are taken from <code>~/.docker/config.json</code> if they are not set.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_buildah"><a class="anchor" href="#_buildah"></a>Buildah</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://buildah.io/">Buildah</a> is a tool for building OCI-compatible images through a lower-level coreutils interface. Buildah doesn&#8217;t depend on a daemon, such as Docker or CRI-O, and it doesn&#8217;t require root privileges.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start the following Linux container which contains <code>buildah</code> binary installed in interactive mode:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run -it --device /dev/fuse:rw --security-opt seccomp=unconfined --security-opt apparmor=unconfined quay.io/buildah/stable bash</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we are inside the Linux container so any command is executed in the running container.</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">[root@eab8e3a260d8 /]# uname --all
Linux eab8e3a260d8 4.19.76-linuxkit #1 SMP Thu Oct 17 19:31:58 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a <code>Dockerfile</code> inside the container:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &gt; Dockerfile &lt;&lt; END \

FROM fedora:34
LABEL maintainer Chris Collins &lt;<a href="mailto:collins.christopher@gmail.com">collins.christopher@gmail.com</a>&gt;

RUN dnf install -y tar gzip gcc make \
        &amp;&amp; dnf clean all

ADD <a href="http://ftpmirror.gnu.org/hello/hello-2.10.tar.gz" class="bare">http://ftpmirror.gnu.org/hello/hello-2.10.tar.gz</a> /tmp/hello-2.10.tar.gz

RUN tar xvzf /tmp/hello-2.10.tar.gz -C /opt

WORKDIR /opt/hello-2.10

RUN ./configure
RUN make
RUN make install
RUN hello -v
ENTRYPOINT "/usr/local/bin/hello"
END</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s build now the Linux container image using <code>buildah</code>. Notice that this container is built within a running container.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">buildah bud --layers -t docker.io/lordofthejars/hello:1.0.0 .</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">...
STEP 10: RUN hello -v
hello (GNU Hello) 2.10

Copyright (C) 2014 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
--&gt; 30beeea056f
STEP 11: ENTRYPOINT "/usr/local/bin/hello"
STEP 12: COMMIT docker.io/lordofthejars/hello:1.0.0
--&gt; 1de25d78a30
1de25d78a30d5ded2aaab3c484469752628e188f919defe10c5b1121526909c8</code></pre>
</div>
</div>
<div class="paragraph">
<p>The image is committed to local machine but not pushed to container registry.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">buildah images</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">REPOSITORY                          TAG     IMAGE ID       CREATED         SIZE
docker.io/lordofthejars/hello       1.0.0   1de25d78a30d   7 minutes ago   373 MB
registry.fedoraproject.org/fedora   34      5f05951e2065   5 days ago      187 MB</code></pre>
</div>
</div>
<div class="paragraph">
<p>To push the image to the container registry:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">buildah push --tls-verify=false --creds=username:password docker.io/lordofthejars/hello:1.0.0 docker.io/lordofthejars/hello:1.0.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that <code>--creds</code> is set with the username and password to access Docker Hub.
By default, <code>buildah</code> reads credentials from <code>~/.docker/config.json</code>, but since this is a fresh container, credentials must be provided.</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Getting image source signatures
Copying blob b29c4850380c done
Copying blob 13ab19dd2ece done
Copying blob 4793a7e290ce done
Copying blob 4582e1897cf2 done
Copying blob cf75f156ae2e done
Copying blob bdcb28f5294e done
Copying blob 5f70bf18a086 done
Copying blob c5e55ed43ef3 done
Copying config 1de25d78a3 done
Writing manifest to image destination
Storing signatures</code></pre>
</div>
</div>
<div class="paragraph">
<p>A Linux container has been created and pushed to the registry from another Linux container.
You can stop the <code>buildah</code> container by typing <code>exit</code>.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="pushing.html">Pushing an image to a public registry</a></span>
  <span class="next"><a href="skopeo.html">Skopeo</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
